# 🛡️ 미소핀의원 웹사이트 안전한 개선 계획 (재검증 완료)

## 📊 전체 위험도 분석 결과

### 현재 프로젝트 상태
- **운영 중인 의료기관 웹사이트** (다운타임 불가)
- HTML 45개, CSS 38개, JS 35개 파일
- jQuery 버전 혼재 문제 확인
  - 대부분 3.7.1 사용 (안전)
  - quickmenu.html만 3.6.0 사용
  - jquery-1.8.3은 참조 없음 (삭제 가능)
- CSS !important 595개 (대부분 반응형 필수 요소)
- console.log 130개 (9개 파일에 분산)

---

## 🚨 위험도 재평가 결과

### Phase 1: 즉시 조치 작업들

| 작업 | UI 깨짐 위험 | 기능 손상 위험 | 롤백 난이도 | 실제 위험도 | 권장 사항 |
|------|-------------|--------------|-----------|------------|----------|
| **jQuery 통합** | 3/10 | 5/10 | 2/10 | **중간** | ⚠️ 단계별 진행 |
| **console.log 제거** | 0/10 | 1/10 | 1/10 | **매우 낮음** | ✅ 즉시 실행 가능 |
| **보안 패치 (eval)** | 0/10 | 0/10 | 0/10 | **없음** | ✅ 즉시 실행 (파일 삭제만) |
| **innerHTML 수정** | 4/10 | 6/10 | 3/10 | **중간** | ⚠️ 선별적 적용 |

### Phase 2: 단기 개선 작업들

| 작업 | UI 깨짐 위험 | 기능 손상 위험 | 롤백 난이도 | 실제 위험도 | 권장 사항 |
|------|-------------|--------------|-----------|------------|----------|
| **Vite 빌드 시스템** | 2/10 | 2/10 | 2/10 | **낮음** | ✅ 병렬 운영으로 안전 |
| **파일 구조 변경** | 9/10 | 8/10 | 8/10 | **매우 높음** | ❌ 권장하지 않음 |
| **CSS !important 제거** | 10/10 | 10/10 | 9/10 | **극도로 높음** | ❌ 절대 권장하지 않음 |

---

## ✅ 안전한 실행 계획 (재수립)

### 🟢 Stage 1: 무위험 작업 (즉시 실행 가능)

#### 1. console.log 제거 (위험도: 0/10)
```bash
# 안전한 자동 제거 스크립트
sed -i.bak 's/console\.log/\/\/console.log/g' js/*.js
sed -i.bak 's/console\.error/\/\/console.error/g' js/*.js
```
- **영향 파일**: 9개
- **롤백**: .bak 파일로 즉시 복구 가능
- **검증**: 브라우저 콘솔 확인

#### 2. 미사용 jQuery 파일 삭제 (위험도: 0/10)
```bash
# jquery-1.8.3은 참조가 없으므로 안전하게 삭제
rm js/vendor/jquery-1.8.3.min.js
```
- **영향**: 없음 (참조하는 곳이 없음)
- **검증**: grep으로 재확인

#### 3. 이미지 최적화 (위험도: 0/10)
- WebP 변환, 압축
- 원본 백업 후 진행
- 레이아웃 영향 없음

---

### 🟡 Stage 2: 저위험 작업 (신중한 실행)

#### 1. jQuery 버전 통일 (위험도: 3/10)
```bash
# Step 1: quickmenu.html의 jQuery 버전만 업데이트
sed -i 's/jquery-3.6.0/jquery-3.7.1/g' quickmenu.html

# Step 2: jquery-migrate 유지 (호환성 보장)
# Step 3: 3.6.0 파일은 백업 후 제거
mv js/libs/jquery-3.6.0.min.js js/libs/jquery-3.6.0.min.js.backup
```
- **영향 파일**: quickmenu.html 1개
- **검증 방법**: quickmenu 기능 테스트
- **롤백**: backup 파일 복구

#### 2. Vite 개발 환경 구축 (위험도: 2/10)
```javascript
// vite.config.js - 기존 구조 100% 유지
export default {
  root: './', // 현재 구조 그대로
  publicDir: 'false', // 복사 방지
  build: {
    outDir: 'dist-vite', // 기존 dist와 분리
    emptyOutDir: false,
    rollupOptions: {
      input: {
        main: 'index.html',
        // 기존 HTML 경로 매핑
      }
    }
  }
}
```
- **전략**: 개발 환경에서만 사용
- **프로덕션**: 기존 방식 유지
- **병렬 운영**: dist/ (현재) vs dist-vite/ (테스트)

---

### 🔴 Stage 3: 고위험 작업 (대안 전략)

#### 1. CSS !important 처리 (위험도: 10/10 → 2/10)
**기존 계획 폐기**, 대신:
```css
/* 전략 변경: 제거가 아닌 문서화와 격리 */

/* critical-overrides.css - 절대 수정 금지 */
/* CRITICAL: 모바일/데스크톱 전환에 필수 */
.mobile-only { display: none !important; } /* DO NOT REMOVE */
.desktop-only { display: block !important; } /* DO NOT REMOVE */

/* new-components.css - 새 컴포넌트만 BEM 적용 */
.new-component { /* No !important */ }
```

#### 2. 파일 구조 (위험도: 9/10 → 1/10)
**기존 계획 폐기**, 대신:
```bash
# 하이브리드 전략: 기존 유지 + 새 구조 추가
.
├── css/          # 절대 건드리지 않음
├── js/           # 절대 건드리지 않음
├── src-new/      # 새 컴포넌트만
│   ├── components/
│   └── modules/
└── dist/         # 기존 운영
    └── dist-test/ # 테스트용
```

---

## 📋 실행 체크리스트 (우선순위별)

### ✅ Week 1: 무위험 작업
```bash
[ ] console.log 제거 (자동 스크립트)
[ ] jquery-1.8.3.min.js 삭제
[ ] 이미지 최적화 (WebP)
[ ] Analytics ID 실제 값 설정
[ ] 디버그 모드 비활성화
```

### ⚠️ Week 2-3: 저위험 작업
```bash
[ ] quickmenu.html jQuery 버전 통일
[ ] jquery-migrate 동작 확인
[ ] Vite 개발 환경 설정 (병렬)
[ ] package.json 생성
[ ] 개발/프로덕션 분리
```

### 🚫 연기 또는 재검토 필요
```bash
[X] CSS !important 제거 → 유지하되 문서화
[X] 파일 구조 전면 개편 → 하이브리드 방식
[X] 전면적 빌드 시스템 전환 → 점진적 도입
```

---

## 🎯 성공 기준 (수정됨)

### 단기 목표 (1개월)
- ✅ console.log 0개
- ✅ jQuery 단일 버전 (3.7.1)
- ✅ 보안 취약점 0개
- ✅ 개발 환경 개선
- ✅ **UI 깨짐 0건**
- ✅ **다운타임 0분**

### 중기 목표 (3개월)
- 📈 Lighthouse 점수 70 → 85
- 📦 npm 기반 의존성 관리
- 🎨 새 컴포넌트는 BEM 적용
- 📊 성능 모니터링 도구

### 장기 목표 (6개월+)
- 🏗️ 점진적 현대화
- 🧪 테스트 커버리지 구축
- 📚 완전한 문서화

---

## ⚠️ 중요 경고사항

### 절대 하지 말아야 할 것들
1. **CSS !important 일괄 제거** - UI 완전 붕괴
2. **파일 구조 전면 변경** - 모든 경로 깨짐
3. **jQuery 강제 업그레이드** - 플러그인 호환성 문제
4. **빌드 시스템 즉시 전환** - 워크플로우 중단

### 반드시 지켜야 할 원칙
1. **백업 우선** - 모든 변경 전 백업
2. **단계별 검증** - 작은 변경 → 테스트 → 다음 단계
3. **병렬 운영** - 기존 시스템 유지하며 새 시스템 테스트
4. **롤백 준비** - 모든 단계에서 즉시 롤백 가능

---

## 📞 비상 대응 계획

### 문제 발생 시
1. **즉시 롤백** (git revert 또는 백업 복구)
2. **영향 범위 파악** (어느 페이지가 영향받았는지)
3. **임시 조치** (문제 부분만 이전 버전으로)
4. **근본 원인 분석** 후 재시도

### 롤백 명령어
```bash
# Git을 사용하는 경우
git revert HEAD
git checkout -- .

# 백업 파일 복구
cp *.bak 원본파일명
```

---

*이 계획은 실제 운영 환경의 안정성을 최우선으로 작성되었습니다.*
*모든 작업은 0% 다운타임, 0% UI 깨짐을 목표로 합니다.*